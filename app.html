<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YouTube Video Listing</title>
    <link rel="stylesheet" href="modern.css">
</head>
<body>
    <header>
        <div class="container">
            <div class="logo">
                <svg viewBox="0 0 90 20" class="youtube-logo">
                    <path fill="#FF0000" d="M88.5 3.5c-.5-2-2-3.5-4-4C80.5 0 50 0 50 0S19.5 0 15.5 1c-2 .5-3.5 2-4 4C10 7.5 10 16 10 16s0 8.5 1.5 12.5c.5 2 2 3.5 4 4 4 1.5 34.5 1.5 34.5 1.5s30.5 0 34.5-1.5c2-.5 3.5-2 4-4C90 24.5 90 16 90 16s0-8.5-1.5-12.5z"/>
                    <path fill="#FFF" d="M40 23V9l13 7-13 7z"/>
                </svg>
                <h1>VideoHub</h1>
            </div>
            <div class="search-bar">
                <input type="text" id="searchInput" placeholder="Search videos...">
                <button id="searchBtn">
                    <svg viewBox="0 0 24 24" width="20" height="20">
                        <path fill="currentColor" d="M15.5 14h-.79l-.28-.27A6.471 6.471 0 0 0 16 9.5 6.5 6.5 0 1 0 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/>
                    </svg>
                </button>
            </div>
        </div>
    </header>

    <main class="container">
        <div class="filters">
            <button class="filter-btn active" data-category="all">All</button>
            <button class="filter-btn" data-category="music">Music</button>
            <button class="filter-btn" data-category="gaming">Gaming</button>
            <button class="filter-btn" data-category="education">Education</button>
            <button class="filter-btn" data-category="tech">Technology</button>
            <button class="filter-btn" data-category="entertainment">Entertainment</button>
        </div>

        <div id="continueWatching" class="continue-watching" style="display: none;">
            <h2>Continue Watching</h2>
            <div id="continueGrid" class="continue-grid"></div>
        </div>

        <div id="videoGrid" class="video-grid">
        </div>
    </main>

    <div id="videoModal" class="modal">
        <div class="modal-content">
            <span class="close">×</span>
            <div class="video-player">
                <iframe id="videoPlayer" width="100%" height="500" frameborder="0" allowfullscreen allow="autoplay"></iframe>
            </div>
            <div class="video-details">
                <h2 id="modalTitle"></h2>
                <div class="video-meta">
                    <span id="modalChannel"></span>
                    <span id="modalViews"></span>
                    <span id="modalDate"></span>
                </div>
                <p id="modalDescription"></p>
                <div class="watch-controls">
                    <span id="currentWatchTime">Watch time: 0s</span>
                    <button id="saveWatchTimeBtn" onclick="saveCurrentWatchTime()">Save Watch Time</button>
                    <button id="resetWatchTimeBtn" onclick="resetWatchTime()">Reset</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        const app = {
            // Application state
            state: {
                videos: [],
                watchHistory: {},
                currentVideoId: null,
                watchStartTime: null,
                watchInterval: null,
                currentCategory: 'all',
                searchQuery: '',
            },

            // DOM elements
            elements: {
                continueWatchingContainer: null,
                continueWatchingGrid: null,
                videoGrid: null,
                modal: null,
                videoPlayer: null,
                modalTitle: null,
                modalChannel: null,
                modalViews: null,
                modalDate: null,
                modalDescription: null,
                currentWatchTime: null,
                saveWatchTimeBtn: null,
                resetWatchTimeBtn: null,
                searchInput: null,
                searchBtn: null,
                closeBtn: null,
            },

            // Initialization
            init() {
                this.cacheDOMElements();
                this.loadData();
                this.render();
                this.bindEvents();
                console.log('Application initialized');
            },

            // Cache DOM elements for performance
            cacheDOMElements() {
                this.elements.continueWatchingContainer = document.getElementById('continueWatching');
                this.elements.continueWatchingGrid = document.getElementById('continueGrid');
                this.elements.videoGrid = document.getElementById('videoGrid');
                this.elements.modal = document.getElementById('videoModal');
                this.elements.videoPlayer = document.getElementById('videoPlayer');
                this.elements.modalTitle = document.getElementById('modalTitle');
                this.elements.modalChannel = document.getElementById('modalChannel');
                this.elements.modalViews = document.getElementById('modalViews');
                this.elements.modalDate = document.getElementById('modalDate');
                this.elements.modalDescription = document.getElementById('modalDescription');
                this.elements.currentWatchTime = document.getElementById('currentWatchTime');
                this.elements.saveWatchTimeBtn = document.getElementById('saveWatchTimeBtn');
                this.elements.resetWatchTimeBtn = document.getElementById('resetWatchTimeBtn');
                this.elements.searchInput = document.getElementById('searchInput');
                this.elements.searchBtn = document.getElementById('searchBtn');
                this.elements.closeBtn = document.querySelector('.close');
            },

            // Load videos and watch history from localStorage
            loadData() {
                const savedVideos = localStorage.getItem('videos');
                this.state.videos = savedVideos ? JSON.parse(savedVideos) : this.getDefaultVideos();
                
                const savedHistory = localStorage.getItem('watchHistory');
                this.state.watchHistory = savedHistory ? JSON.parse(savedHistory) : {};
            },

            // Save watch history to localStorage
            saveWatchHistory() {
                localStorage.setItem('watchHistory', JSON.stringify(this.state.watchHistory));
            },

            // Render all components
            render() {
                this.renderContinueWatching();
                this.renderVideos();
            },

            // Bind all event listeners
            bindEvents() {
                // Filter buttons
                const filterButtons = document.querySelectorAll('.filter-btn');
                filterButtons.forEach(button => {
                    button.addEventListener('click', (e) => {
                        filterButtons.forEach(btn => btn.classList.remove('active'));
                        e.currentTarget.classList.add('active');
                        this.state.currentCategory = e.currentTarget.dataset.category;
                        this.renderVideos();
                    });
                });

                // Search functionality
                this.elements.searchBtn.addEventListener('click', () => {
                    this.state.searchQuery = this.elements.searchInput.value;
                    this.renderVideos();
                });

                this.elements.searchInput.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') {
                        this.state.searchQuery = this.elements.searchInput.value;
                        this.renderVideos();
                    }
                });

                this.elements.searchInput.addEventListener('input', (e) => {
                    if (e.target.value === '') {
                        this.state.searchQuery = '';
                        this.renderVideos();
                    }
                });

                // Modal events
                this.elements.closeBtn.addEventListener('click', () => this.closeModal());
                window.addEventListener('click', (e) => {
                    if (e.target === this.elements.modal) {
                        this.closeModal();
                    }
                });
            },

            // Render the "Continue Watching" section
            renderContinueWatching() {
                const inProgressVideos = this.state.videos.filter(video => {
                    const history = this.state.watchHistory[video.id];
                    if (!history) return false;
                    const totalSeconds = this.parseDuration(video.duration);
                    const progress = totalSeconds > 0 ? (history.watchedSeconds / totalSeconds) * 100 : 0;
                    return progress > 0 && progress < 95;
                }).sort((a, b) => {
                    return (this.state.watchHistory[b.id]?.lastWatched || 0) - (this.state.watchHistory[a.id]?.lastWatched || 0);
                }).slice(0, 5);

                if (inProgressVideos.length === 0) {
                    this.elements.continueWatchingContainer.style.display = 'none';
                    return;
                }

                this.elements.continueWatchingContainer.style.display = 'block';
                this.elements.continueWatchingGrid.innerHTML = '';

                inProgressVideos.forEach(video => {
                    const progress = this.getWatchProgress(video.id, video.duration);
                    const history = this.state.watchHistory[video.id];
                    const videoCard = this.createVideoCard(video, true, progress, history);
                    this.elements.continueWatchingGrid.appendChild(videoCard);
                });
            },

            // Render the main video grid
            renderVideos() {
                let filteredVideos = this.state.videos;

                if (this.state.currentCategory !== 'all') {
                    filteredVideos = filteredVideos.filter(video => video.category === this.state.currentCategory);
                }

                if (this.state.searchQuery) {
                    const query = this.state.searchQuery.toLowerCase();
                    filteredVideos = filteredVideos.filter(video =>
                        video.title.toLowerCase().includes(query) ||
                        video.channel.toLowerCase().includes(query)
                    );
                }

                this.elements.videoGrid.innerHTML = '';
                filteredVideos.forEach(video => {
                    const progress = this.getWatchProgress(video.id, video.duration);
                    const history = this.state.watchHistory[video.id];
                    const videoCard = this.createVideoCard(video, false, progress, history);
                    this.elements.videoGrid.appendChild(videoCard);
                });
            },
            
            // Create a video card element
            createVideoCard(video, isContinueWatching, progress, history) {
                const videoCard = document.createElement('div');
                videoCard.className = 'video-card';
                videoCard.onclick = () => this.openModal(video);

                let watchedBadge = '';
                if (isContinueWatching) {
                    watchedBadge = `<span class="watched-badge">${this.formatWatchTime(history.watchedSeconds)} watched</span>`;
                } else if (history && history.watchedSeconds > 0) {
                    const totalSeconds = this.parseDuration(video.duration);
                    if (history.watchedSeconds / totalSeconds >= 0.95) {
                        watchedBadge = '<span class="watched-badge">Watched</span>';
                    } else {
                        watchedBadge = `<span class="watched-badge">${this.formatWatchTime(history.watchedSeconds)}</span>`;
                    }
                }
                
                videoCard.innerHTML = `
                    <div class="video-thumbnail">
                        <img src="${video.thumbnail}" alt="${video.title}">
                        <span class="video-duration">${video.duration}</span>
                        ${watchedBadge}
                        ${progress > 0 ? `<div class="watch-progress" style="width: ${progress}%"></div>` : ''}
                    </div>
                    <div class="video-info">
                        <h3 class="video-title">${video.title}</h3>
                        <p class="video-channel">${video.channel}</p>
                        <div class="video-meta">
                            <span>${video.views}</span>
                            <span>•</span>
                            <span>${video.date}</span>
                        </div>
                        ${!isContinueWatching ? `<span class="category-badge">${video.category}</span>` : ''}
                    </div>
                `;
                return videoCard;
            },

            // Open the video modal
            openModal(video) {
                this.elements.videoPlayer.src = video.videoUrl + '?autoplay=1&enablejsapi=1';
                this.elements.modalTitle.textContent = video.title;
                this.elements.modalChannel.textContent = video.channel;
                this.elements.modalViews.textContent = video.views;
                this.elements.modalDate.textContent = video.date;
                this.elements.modalDescription.textContent = video.description;

                this.elements.modal.style.display = 'block';
                this.startWatchTracking(video.id);
            },

            // Close the video modal
            closeModal() {
                this.stopWatchTracking();
                this.elements.modal.style.display = 'none';
                this.elements.videoPlayer.src = '';
            },

            // Watch time tracking
            startWatchTracking(videoId) {
                this.state.currentVideoId = videoId;
                this.state.watchStartTime = Date.now();
                this.updateWatchTimeDisplay();

                if (this.state.watchInterval) clearInterval(this.state.watchInterval);
                this.state.watchInterval = setInterval(() => {
                    if (this.state.currentVideoId && this.state.watchStartTime) {
                        const elapsed = (Date.now() - this.state.watchStartTime) / 1000;
                        if (!this.state.watchHistory[this.state.currentVideoId]) {
                            this.state.watchHistory[this.state.currentVideoId] = { watchedSeconds: 0, lastWatched: Date.now() };
                        }
                        this.state.watchHistory[this.state.currentVideoId].watchedSeconds += elapsed;
                        this.state.watchHistory[this.state.currentVideoId].lastWatched = Date.now();
                        this.state.watchStartTime = Date.now();
                        this.updateWatchTimeDisplay();
                    }
                }, 1000);
            },

            stopWatchTracking() {
                if (this.state.currentVideoId && this.state.watchStartTime) {
                    const elapsed = (Date.now() - this.state.watchStartTime) / 1000;
                    if (!this.state.watchHistory[this.state.currentVideoId]) {
                        this.state.watchHistory[this.state.currentVideoId] = { watchedSeconds: 0, lastWatched: Date.now() };
                    }
                    this.state.watchHistory[this.state.currentVideoId].watchedSeconds += elapsed;
                    this.state.watchHistory[this.state.currentVideoId].lastWatched = Date.now();
                    this.saveWatchHistory();
                }
                if (this.state.watchInterval) {
                    clearInterval(this.state.watchInterval);
                    this.state.watchInterval = null;
                }
                this.state.currentVideoId = null;
                this.state.watchStartTime = null;
                this.render();
            },

            updateWatchTimeDisplay() {
                if (this.state.currentVideoId && this.state.watchHistory[this.state.currentVideoId]) {
                    this.elements.currentWatchTime.textContent = `Watch time: ${this.formatWatchTime(this.state.watchHistory[this.state.currentVideoId].watchedSeconds)}`;
                } else {
                    this.elements.currentWatchTime.textContent = 'Watch time: 0s';
                }
            },
            
            saveCurrentWatchTime() {
                if (this.state.currentVideoId && this.state.watchStartTime) {
                    const elapsed = (Date.now() - this.state.watchStartTime) / 1000;
                    if (!this.state.watchHistory[this.state.currentVideoId]) {
                        this.state.watchHistory[this.state.currentVideoId] = { watchedSeconds: 0, lastWatched: Date.now() };
                    }
                    this.state.watchHistory[this.state.currentVideoId].watchedSeconds += elapsed;
                    this.state.watchHistory[this.state.currentVideoId].lastWatched = Date.now();
                    this.state.watchStartTime = Date.now();
                    this.saveWatchHistory();
                    this.updateWatchTimeDisplay();
                    
                    this.elements.saveWatchTimeBtn.textContent = 'Saved!';
                    this.elements.saveWatchTimeBtn.classList.add('save-success');
                    setTimeout(() => {
                        this.elements.saveWatchTimeBtn.textContent = 'Save Watch Time';
                        this.elements.saveWatchTimeBtn.classList.remove('save-success');
                    }, 1500);
                }
            },
            
            resetWatchTime() {
                if (this.state.currentVideoId) {
                    delete this.state.watchHistory[this.state.currentVideoId];
                    this.saveWatchHistory();
                    this.state.watchStartTime = Date.now();
                    this.updateWatchTimeDisplay();

                    this.elements.resetWatchTimeBtn.textContent = 'Reset!';
                    setTimeout(() => {
                        this.elements.resetWatchTimeBtn.textContent = 'Reset';
                    }, 1000);
                }
            },

            // Utility functions
            parseDuration(durationStr) {
                const parts = durationStr.split(':').map(Number);
                if (parts.length === 3) return parts[0] * 3600 + parts[1] * 60 + parts[2];
                if (parts.length === 2) return parts[0] * 60 + parts[1];
                return 0;
            },

            formatWatchTime(seconds) {
                if (seconds < 60) return `${Math.floor(seconds)}s`;
                if (seconds < 3600) return `${Math.floor(seconds / 60)}m ${Math.floor(seconds % 60)}s`;
                const h = Math.floor(seconds / 3600);
                const m = Math.floor((seconds % 3600) / 60);
                return `${h}h ${m}m`;
            },

            getWatchProgress(videoId, videoDuration) {
                const history = this.state.watchHistory[videoId];
                if (!history) return 0;
                const totalSeconds = this.parseDuration(videoDuration);
                if (totalSeconds === 0) return 0;
                return Math.min((history.watchedSeconds / totalSeconds) * 100, 100);
            },
            
            // Default video data
            getDefaultVideos() {
                return [
                    {
                        id: 1,
                        title: "Learn JavaScript in 2024 - Complete Beginner's Guide",
                        channel: "Code Academy",
                        views: "1.2M views",
                        date: "2 weeks ago",
                        duration: "45:32",
                        thumbnail: "https://images.unsplash.com/photo-1516116216624-53e697fedbea?w=640&h=360&fit=crop",
                        category: "education",
                        videoUrl: "https://www.youtube.com/embed/dQw4w9WgXcQ",
                        description: "Master JavaScript from scratch with this comprehensive tutorial."
                    },
                    {
                        id: 2,
                        title: "Top 10 Gaming Moments of 2024",
                        channel: "GameSpot",
                        views: "3.5M views",
                        date: "1 day ago",
                        duration: "15:24",
                        thumbnail: "https://images.unsplash.com/photo-1511512578047-dfb367046420?w=640&h=360&fit=crop",
                        category: "gaming",
                        videoUrl: "https://www.youtube.com/embed/dQw4w9WgXcQ",
                        description: "The most epic gaming moments from this year!"
                    }
                ];
            }
        };

        document.addEventListener('DOMContentLoaded', () => {
            app.init();
        });
        
        // Make watch time functions globally accessible from inline onclick attributes
        function saveCurrentWatchTime() {
            app.saveCurrentWatchTime();
        }
        function resetWatchTime() {
            app.resetWatchTime();
        }
    </script>
</body>
</html>
